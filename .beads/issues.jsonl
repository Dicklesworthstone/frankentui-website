{"id":"bd-17l","title":"beads-viewer: Mobile Tables + Revision Legend + UX/Test Hardening","description":"CONTEXT\n- The static beads viewer lives at public/beads-viewer/index.html and renders markdown (marked + DOMPurify) into .prose blocks (issue descriptions, graph node details, etc.).\n- On mobile, markdown tables (the 'ledger' style tables we use in writeups) are currently hard to read: the first column collapses too far, tables look broken, and users feel pushed into horizontal scrolling.\n- We also need a clear, mobile-friendly legend for the 'revision type' indicator (10 categories), with hover tooltip on desktop and an interaction that works on touch devices.\n\nGOALS (USER-VISIBLE)\n1) Mobile markdown tables are readable by default.\n   - No required horizontal scrolling.\n   - The first column never collapses into unreadable slivers.\n   - Dense tables degrade gracefully without losing information.\n2) Revision type is understandable at a glance.\n   - Desktop: hover tooltip.\n   - Mobile: tap-to-open legend (bottom sheet / popover) with the full mapping of the 10 categories.\n3) Add obviously accretive functionality around these areas (table interactions + revision ledger UX) without making the viewer fragile.\n4) Ship with rigorous tests + diagnostics logging so regressions are caught immediately.\n\nNON-GOALS\n- No rewrite of the viewer stack (still static, still sql.js, still offline-friendly).\n- No dependency bloat unless it is clearly the simplest/most robust option.\n\nTECHNICAL CONSTRAINTS\n- Must stay compatible with current CSP/offline model (self-contained assets in public/beads-viewer).\n- Preserve security posture: sanitize markdown output (DOMPurify) and do not introduce XSS surfaces.\n\nQUALITY BAR\n- Unit tests for: table postprocessing logic, revision-type parsing/mapping, and any new UI state reducers/helpers.\n- E2E tests (Playwright) for: mobile viewport rendering, table layout behavior, legend interaction on touch, and 'no console errors' guard.\n- Detailed test logging: JSONL logs with env, viewport, timings, console events, and deterministic run mode.\n\nDELIVERABLE\n- A coherent set of sub-beads with dependency structure that implements all the above, plus deployment verification on Vercel.","status":"open","priority":1,"issue_type":"epic","created_at":"2026-02-08T16:56:12.667107352Z","created_by":"ubuntu","updated_at":"2026-02-08T16:56:12.667107352Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-17l.1","title":"Mobile Markdown Tables: No-Side-Scroll Responsive Layout","description":"PROBLEM\n- Markdown tables rendered inside .prose (issue descriptions, graph detail panes) look broken on small screens.\n- The first column collapses too aggressively, producing unreadable 'vertical text' or extreme wrapping.\n\nGOAL\n- Make tables readable on mobile with zero required horizontal scrolling.\n\nDESIGN (HIGH LEVEL)\n- Treat tables differently by shape:\n  1) 2-column tables (key/value): on mobile, render each row as a compact card with key on top and value below (no columns).\n  2) 3+ column tables (matrix): on mobile, render each row as a stacked set of label/value pairs using header-derived labels.\n- Preserve semantics and information density on desktop (normal table layout), but never let mobile collapse into unreadable geometry.\n- Ensure behavior is deterministic and compatible with DOMPurify sanitization.\n\nACCEPTANCE CRITERIA\n- On a 390x844 viewport (iPhone 12-ish), tables are readable:\n  - No horizontal scrollbars needed for normal use.\n  - First-column content is legible and does not collapse below a sane minimum.\n- Desktop layout remains table-like and visually consistent.\n- Works for tables produced by marked's GFM output.\n\nTESTING\n- Unit tests for table DOM postprocessing (header extraction, cell labeling, shape classification).\n- E2E tests that load an issue containing representative 2-col and 3+ col tables and verify mobile styling.\n\nIMPLEMENTATION NOTE\n- Likely requires post-processing sanitized DOM in renderMarkdown() to add data-label attributes and table shape classes.","status":"open","priority":1,"issue_type":"epic","created_at":"2026-02-08T16:56:24.781984601Z","created_by":"ubuntu","updated_at":"2026-02-08T16:56:24.781984601Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-17l.1","depends_on_id":"bd-17l","type":"parent-child","created_at":"2026-02-08T16:56:24.781984601Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-17l.1.1","title":"Repro: Identify Broken Mobile Tables + Capture Fixtures","description":"WHY\nWe need to fix the right thing. Table breakage can differ by table shape (2-col vs 3+ col), content (long tokens, URLs, code), and container (issue modal vs graph detail).\n\nWHAT TO DO\n- Load public/beads-viewer/ in a mobile viewport and find at least:\n  1) A representative 2-column key/value markdown table.\n  2) A representative 3+ column markdown table.\n  3) A pathological case: long unbroken tokens, long IDs, or inline code.\n- Capture screenshots (before) and note the issue IDs where these descriptions appear.\n- Record which view(s) render them (issue modal description, graph detail, etc.).\n\nACCEPTANCE CRITERIA\n- We have 3 concrete fixture tables with issue IDs and 'expected' notes, ready to use in E2E tests.\n\nOUTPUT\n- Update this bead with the fixture IDs and short notes once found.","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-08T16:56:35.145567227Z","created_by":"ubuntu","updated_at":"2026-02-08T16:56:35.145567227Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-17l.1.1","depends_on_id":"bd-17l.1","type":"parent-child","created_at":"2026-02-08T16:56:35.145567227Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-17l.1.2","title":"Implement Markdown Table Postprocessing (data-label + shape classes)","description":"SCOPE\n- Enhance public/beads-viewer/viewer.js renderMarkdown() to postprocess sanitized DOM output.\n\nMOTIVATION\n- CSS alone can't reliably turn a table into a mobile-friendly stacked layout without labels.\n- We need header-derived labels (thead/th) to be available on each cell.\n\nDESIGN\n- Pipeline:\n  1) marked.parse(text) -> HTML\n  2) DOMPurify.sanitize(html, { RETURN_DOM_FRAGMENT: true }) -> safe DOM fragment\n  3) enhanceTables(fragment):\n     - For each table:\n       - Extract headers: <thead> <th> textContent, trimmed.\n       - Count columns; add class:\n         - bv-table bv-table--2col (exactly 2 cols)\n         - bv-table bv-table--ncol (>=3 cols)\n       - For each tbody row, for each td index i:\n         - Set td.dataset.label = headers[i] (or '' if missing)\n       - Add data-bv-table=1 marker for debugging.\n     - Optional: normalize whitespace, handle tables without <thead> gracefully.\n  4) Serialize fragment back to HTML string for Alpine x-html.\n\nACCEPTANCE CRITERIA\n- For a standard GFM table, each <td> ends up with data-label matching its header cell.\n- For a 2-col table, the table element is tagged so CSS can render key/value cards.\n- No XSS regression: postprocessing runs AFTER DOMPurify sanitization.\n\nTESTS\n- Unit tests: given sample HTML strings (marked output), assert headers extracted and data-labels applied deterministically.\n- Negative tests: tables missing thead, mismatched column counts, nested tables, empty cells.","status":"open","priority":1,"issue_type":"feature","created_at":"2026-02-08T16:56:46.813172989Z","created_by":"ubuntu","updated_at":"2026-02-08T16:56:46.813172989Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-17l.1.2","depends_on_id":"bd-17l.1","type":"parent-child","created_at":"2026-02-08T16:56:46.813172989Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-17l.1.3","title":"Add Mobile CSS for Table Cards (2-col) + Labeled Rows (N-col)","description":"FILES\n- public/beads-viewer/styles.css\n\nGOAL\n- Use the classes added by bd-17l.1.2 to render tables in a mobile-native format.\n\nDESIGN\n- Desktop/tablet: keep classic table styling (striped rows, borders).\n- Mobile (<= 640px):\n  - .bv-table--2col:\n    - Hide thead visually.\n    - Render each tbody tr as a card with:\n      - First td = key/title (bold, full width)\n      - Second td = value (muted label, wraps naturally)\n    - No internal cell borders.\n  - .bv-table--ncol:\n    - Hide thead visually.\n    - Render each td as a 2-col grid (label/value):\n      - td::before { content: attr(data-label) }\n      - Grid template columns: minmax(7rem, 40%) 1fr (prevents skinny label column)\n    - Render each tr as a card with subtle border + spacing.\n\nACCESSIBILITY\n- If hiding <thead>, prefer a visually-hidden approach instead of display:none so screen readers can still derive context.\n\nACCEPTANCE CRITERIA\n- Mobile: no horizontal scrolling required for typical ledger tables.\n- Mobile: first column/key is never 'skinny'; key/value layout reads naturally.\n- Desktop: table still looks like a table.\n\nDEPENDENCY\n- Depends on bd-17l.1.2 so the classes/data-label exist.\n\nTESTS\n- E2E: screenshot diffs or layout assertions in Playwright at mobile viewport.","status":"open","priority":1,"issue_type":"feature","created_at":"2026-02-08T16:56:57.750708678Z","created_by":"ubuntu","updated_at":"2026-02-08T16:57:11.685633454Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-17l.1.3","depends_on_id":"bd-17l.1","type":"parent-child","created_at":"2026-02-08T16:56:57.750708678Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-17l.1.3","depends_on_id":"bd-17l.1.2","type":"blocks","created_at":"2026-02-08T16:57:11.685596014Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-17l.1.4","title":"Table UX: View Toggle (Table vs Cards) + Copy/Export (CSV/TSV)","description":"USER VALUE\n- Some users will prefer classic tables even on mobile (especially for small 3-col tables), while others want card mode.\n- Copying ledger tables into notes/spreadsheets is a common workflow.\n\nFEATURES\n1) Per-table view toggle\n- Default on mobile: card/stacked mode.\n- Provide a small control (e.g., 'View: Cards | Table') per table.\n- Persist preference globally in localStorage (so users don't re-toggle constantly).\n\n2) Copy / export actions\n- 'Copy as TSV' for spreadsheet-friendly paste.\n- 'Download CSV' for offline use.\n\nDESIGN NOTES\n- Because markdown tables are generated HTML, controls must be injected post-render.\n- Avoid breaking sanitization: inject controls into already-sanitized DOM.\n- Make controls unobtrusive; hide unless table is hovered (desktop) or via a small 'â‹¯' button (mobile).\n\nACCEPTANCE CRITERIA\n- On mobile, user can switch a table back to classic table rendering.\n- Copy/export produces correct headers + row values.\n- No page-level horizontal scroll introduced.\n\nTESTS\n- Unit: HTML->TSV/CSV conversion correctness for tricky cells (links, code, line breaks).\n- E2E: toggling persists across modal close/reopen (localStorage).","status":"open","priority":2,"issue_type":"feature","created_at":"2026-02-08T16:57:22.012638557Z","created_by":"ubuntu","updated_at":"2026-02-08T16:57:26.201352083Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-17l.1.4","depends_on_id":"bd-17l.1","type":"parent-child","created_at":"2026-02-08T16:57:22.012638557Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-17l.1.4","depends_on_id":"bd-17l.1.2","type":"blocks","created_at":"2026-02-08T16:57:26.132935268Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-17l.1.4","depends_on_id":"bd-17l.1.3","type":"blocks","created_at":"2026-02-08T16:57:26.201310014Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-17l.1.5","title":"A11y: Responsive Tables Keep Context (SR-only headers, focus, contrast)","description":"SCOPE\n- Ensure responsive table transformations do not make the content worse for accessibility.\n\nCHECKLIST\n- When hiding <thead> on mobile, do it via a visually-hidden pattern (not display:none) so screen readers can still navigate by header context.\n- Ensure injected controls (toggle/copy) are keyboard accessible with clear focus states.\n- Ensure color contrast remains AA in both light and dark.\n\nACCEPTANCE CRITERIA\n- VoiceOver/NVDA navigation across a transformed table still communicates header/label context.\n- No focus traps introduced in the issue modal.\n\nDEPENDS ON\n- bd-17l.1.2 + bd-17l.1.3 (actual transformation implementation).","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-08T16:57:34.817254067Z","created_by":"ubuntu","updated_at":"2026-02-08T16:57:38.910274139Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-17l.1.5","depends_on_id":"bd-17l.1","type":"parent-child","created_at":"2026-02-08T16:57:34.817254067Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-17l.1.5","depends_on_id":"bd-17l.1.2","type":"blocks","created_at":"2026-02-08T16:57:38.842830856Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-17l.1.5","depends_on_id":"bd-17l.1.3","type":"blocks","created_at":"2026-02-08T16:57:38.910234755Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-17l.2","title":"Revision Types: Badge System + Legend (Desktop hover, Mobile tap)","description":"PROBLEM\n- Users see a 'revision type' indicator (10 categories), but without a legend it is opaque.\n- Hover tooltips don't exist on mobile; we need a touch-native way to explain the type mapping.\n\nGOALS\n- Single source of truth mapping for 10 revision categories -> label, color, icon, description.\n- Desktop: hover tooltip (and title fallback) for badges.\n- Mobile: tap-to-open legend (bottom sheet/popover) that explains all categories.\n\nDESIGN\n- Expose the legend via an info button adjacent to anywhere the badge appears.\n- Prefer progressive disclosure:\n  - On small screens, show compact badge; user taps for legend.\n  - On desktop, keep UI clean but allow hover + keyboard focus.\n\nACCEPTANCE CRITERIA\n- In a touch-only environment, the user can discover what each revision type means.\n- Legend is accessible (keyboard focus, ARIA labels).\n\nTESTS\n- Unit tests for parsing -> category classification.\n- E2E tests ensuring legend opens on mobile viewport and closes reliably.","status":"open","priority":1,"issue_type":"epic","created_at":"2026-02-08T16:57:47.788169893Z","created_by":"ubuntu","updated_at":"2026-02-08T16:57:47.788169893Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-17l.2","depends_on_id":"bd-17l","type":"parent-child","created_at":"2026-02-08T16:57:47.788169893Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
